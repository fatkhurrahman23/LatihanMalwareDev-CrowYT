#include <stdio.h>
#include <windows.h>

/*
    BOOL WINAPI CreateProcessW(
    _In_opt_     LPCWSTR               lpApplicationName,
    _Inout_opt_  LPWSTR                lpCommandLine,
    _In_opt_     LPSECURITY_ATTRIBUTES lpProcessAttributes,
    _In_opt_     LPSECURITY_ATTRIBUTES lpThreadAttributes,
    _In_         BOOL                  bInheritHandles,
    _In_         DWORD                 dwCreationFlags,
    _In_opt_     LPVOID                lpEnvironment,
    _In_opt_     LPCWSTR               lpCurrentDirectory,
    _In_         LPSTARTUPINFOW        lpStartupInfo,
    _Out_        LPPROCESS_INFORMATION lpProcessInformation
    );
*/

/*
typedef struct _PROCESS_INFORMATION {
  HANDLE hProcess;
  HANDLE hThread;
  DWORD  dwProcessId;
  DWORD  dwThreadId;
} PROCESS_INFORMATION, *PPROCESS_INFORMATION, *LPPROCESS_INFORMATION;
*/

/*
dwPriorityClass = 0;
hProcess = OpenProcess( PROCESS_ALL_ACCESS, FALSE, pe32.th32ProcessID );
if( hProcess == NULL )
	printError( TEXT("OpenProcess") );
else
{
	dwPriorityClass = GetPriorityClass( hProcess );
	if( !dwPriorityClass )
	printError( TEXT("GetPriorityClass") );
	CloseHandle( hProcess );
}
*/

int main(){

    /*
    DWORD TID = pi.dwThreadId;
    DWORD PID = pi.dwProcessId;
    HANDLE hThread = pi.hThread;
    HANDLE hProcess = pi.hProcess;
    */

    STARTUPINFO si = {0};
    PROCESS_INFORMATION pi = {0};

    if (!CreateProcessW(
        L"C:/Windows/System32/notepad.exe",
        NULL,
        NULL,
        NULL,
        FALSE,
        NORMAL_PRIORITY_CLASS,
        NULL,
        NULL,
        &si,
        &pi))
    {
        printf("(-) Failed to start process, error: %ld", GetLastError());
        return EXIT_FAILURE;
    }

    printf("(+) Got handle to process.\n");
    printf("(+) Process started! PID: %i \n", pi.dwProcessId );
    printf("\t(-) ProcessID: %ld, Handler: 0x%x \n", pi.dwProcessId, pi.hProcess);
    printf("\t(-) ThreadID: %ld, Handler: 0x%x \n\r", pi.dwThreadId, pi.hThread);

    WaitForSingleObject(pi.hProcess, INFINITE );
    printf("(+) Finished! exiting.");

    CloseHandle(pi.hProcess);
    CloseHandle(pi.hThread);
    
    return 0;
}